<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Application Details</title>
  <style>
    :root {
      --primary: #4f46e5;
      --primary-dark: #4338ca;
      --background: #f3f4f6;
      --card-bg: #ffffff;
      --error: #dc2626;
      --success: #16a34a;
      --text: #1f2937;
      --text-light: #6b7280;
      --border: #e5e7eb;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: linear-gradient(145deg, var(--background) 0%, #e0e7ff 100%);
      min-height: 100vh;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 2rem 1rem;
    }

    .container {
      background: var(--card-bg);
      padding: clamp(1.5rem, 5vw, 2rem);
      border-radius: 1rem;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 650px;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    h2 {
      text-align: center;
      margin-bottom: 1.5rem;
      color: var(--primary);
      font-size: clamp(1.5rem, 5vw, 1.75rem);
      font-weight: 700;
      letter-spacing: 0.5px;
    }

    .details-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1.5rem;
    }
    .details-table th,
    .details-table td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid var(--border);
      vertical-align: top;
    }
    .details-table th { color: var(--text); font-weight: 600; width: 30%; }
    .details-table td { color: var(--text-light); }

    .copyable {
      position: relative;
      display: inline-flex;
      align-items: center;
      cursor: pointer;
      color: var(--primary);
      transition: color 0.2s;
      outline: none;
    }
    .copyable:hover, .copyable:focus { color: var(--primary-dark); }
    .copy-icon { margin-left: 0.5rem; width: 20px; height: 20px; color: var(--text-light); }
    .copyable:focus { outline: 2px solid var(--primary); outline-offset: 2px; border-radius: 4px; }

    .tooltip {
      position: absolute;
      top: -2rem;
      left: 50%;
      transform: translateX(-50%);
      background: var(--success);
      color: #fff;
      padding: 0.25rem 0.7rem;
      border-radius: 0.25rem;
      font-size: 0.85em;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.18s;
      z-index: 10;
      white-space: nowrap;
    }
    .tooltip.show { opacity: 1; }

    .prompt-content {
      white-space: pre-wrap;
      word-break: break-word;
      max-height: 200px;
      overflow-y: auto;
      padding: 0.5rem;
      background: #f9fafb;
      border-radius: 0.25rem;
    }

    .btn-primary {
      display: inline-block;
      padding: 0.75rem 1.5rem;
      background: var(--primary);
      color: #fff;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 0.5rem;
      text-decoration: none;
      text-align: center;
      transition: background 0.18s, transform 0.18s;
    }
    .btn-primary:hover { background: var(--primary-dark); transform: translateY(-2px); }
    .btn-primary:focus { outline: 2px solid var(--primary-dark); outline-offset: 2px; }
    .back-link { text-align: center; margin-top: 1.3rem; }

    .error-message {
      color: var(--error);
      text-align: center;
      margin-bottom: 1rem;
      font-size: 1em;
      font-weight: 500;
    }

    @media (max-width: 480px) {
      .container { padding: 1.25rem; max-width: 98%; }
      h2 { font-size: 1.5rem; }
      .details-table th, .details-table td { padding: 0.5rem; font-size: 0.95rem; }
      .btn-primary { padding: 0.65rem 1rem; font-size: 0.95rem; }
      .prompt-content { max-height: 120px; }
    }
  </style>
</head>
<body>
<div class="container" role="main" aria-labelledby="details-title">
  <h2 id="details-title">Application Details</h2>
  <div th:if="${error}" class="error-message" role="alert">
    <span th:text="${error}"></span>
  </div>
  <div th:if="${app == null}" class="error-message" role="alert">
    No application found.
  </div>
  <table class="details-table" th:if="${app != null}" aria-label="Application details">
    <tr>
      <th scope="row">Name</th>
      <td th:text="${app.name} ?: 'N/A'">App Name</td>
    </tr>
    <tr>
      <th scope="row">App Token</th>
      <td>
        <span class="copyable" th:id="'appToken-' + ${app.id}" role="button" tabindex="0" aria-label="Copy app token">
          <span class="token-text" th:text="${app.appToken} ?: 'N/A'">App Token</span>
          <svg class="copy-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
            <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
          </svg>
          <span class="tooltip">Copied!</span>
        </span>
      </td>
    </tr>
    <tr>
      <th scope="row">Prompt</th>
      <td>
        <div class="prompt-content" th:text="${app.prompt} ?: 'N/A'">Prompt</div>
      </td>
    </tr>
  </table>
  <div class="back-link">
    <a href="/home" class="btn-primary">Back to App List</a>
  </div>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll('.copyable').forEach(function(element) {
      element.addEventListener('click', function () {
        const text = this.querySelector('.token-text').textContent;
        if (text && text !== 'N/A') {
          navigator.clipboard.writeText(text).then(() => {
            const tooltip = this.querySelector('.tooltip');
            tooltip.classList.add('show');
            setTimeout(() => tooltip.classList.remove('show'), 1300);
          }).catch(err => {
            alert("Failed to copy: " + err);
          });
        }
      });
      element.addEventListener('keydown', function (event) {
        if (event.key === 'Enter' || event.key === ' ') {
          event.preventDefault();
          this.click();
        }
      });
    });
  });
</script>
</body>
</html>
